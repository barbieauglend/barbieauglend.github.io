<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Firmware 101 - How to get the code | barbie's notes</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.1"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Firmware 101 - How to get the code</h1><a id="logo" href="/.">barbie's notes</a><p class="description">my not-professional-at-all blog</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> start</i></a><a href="/archives/"><i class="fa fa-archive"> oldies</i></a><a href="/about/"><i class="fa fa-user"> /me</i></a><a href="/talks/"><i class="fa fa-users"> IRL</i></a><a href="/credits/"><i class="fa fa-heart"> credits</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Firmware 101 - How to get the code</h1><div class="post-meta">2018-08-20<span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1.2k</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 7</span><span class="post-meta-item-text"> Minutes</span></span></span></div><div class="post-content"><h2 id="Extracting-the-Firmware"><a href="#Extracting-the-Firmware" class="headerlink" title="Extracting the Firmware"></a>Extracting the Firmware</h2><p>In the <a href="/2018-07-23-hardware_101">last post</a>, we discussed how to find important information about how to communicate with the device’s. In this post, we are going to describe the standard approach of getting the code we want to reverse and use the information we collected before.</p>
<a id="more"></a>
<h3 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h3><p>One of the most important things to think about when doing reverse engineering is to know what questions you want to answer. If you start looking for ANY kind of information, data or piece of code, you will end with lots of knowledge on stuff you have no idea what it is. Yes, you will drown in a lake of information! So, before starting trying to understand everything, ask the most important questions for you and focus on that. Try to keep your way, and check regularly that you are not deep in the mud.</p>
<p>I often use what I call “Jack the Ripper” approach: do it calmly, piece by piece and try to enjoy it :) Start looking for specifications online about the communication protocol, about the board itself, about the components, try to understand the undocumented part, double check the documented part. When you’re done, go for some critical system or code, like authentication algorithm or password generator / checker, anything that looks like it’s handling juicy data. Embedded systems security is not that advanced, but still all devices need some kind of identification mechanism. These IDs should be unique for each hardware, but at the same time generated in production. They should be able to authenticate somewhere and also be present in the firmware, which is supposed to be the same for all devices. Now, think about solving this problem for large scale production?</p>
<h3 id="Talking-with-the-system"><a href="#Talking-with-the-system" class="headerlink" title="Talking with the system"></a>Talking with the system</h3><p>The best part and the essential difference while reversing hardware is the bare metal in your hand. The electrical signals. It is the possibility of measuring everything and actually see how the data flows. Adding some LEDs in between never gets boring and it is beautiful every single time! If this fact alone make your heart beats a bit faster, same here! It is another kick, way stronger than a piece of code :) Without much information and with the aid of some cheap equipment, it is possible to get lots of information. We already know that with a simple logic analyzer, we can sniff the data traffic. With a more expensive lab however, it is possible to measure the booting energy consumption and from there, guess with great precision even private keys. This is not magic - it is Science! Physics ftw \m/ (btw, remember about the “ideal conditions” you learn at school - they will never happen!)</p>
<h3 id="Data-flow-in-the-PCB"><a href="#Data-flow-in-the-PCB" class="headerlink" title="Data flow in the PCB"></a>Data flow in the PCB</h3><p>What is the point of having data if you can not read, write or even transfer it someway? Having a good look at your board should be enough to give you an idea how the data flows through it. You can take the IC as a starting point and follow the PCB tracks to create your own map. Another important information: most of the microcontrollers have a datasheet living on the Internet, so don’t be shy and go duck duck it. They are publicly available and have all the technical information needed for the beginning - stuff like pinouts, communication protocols used, the voltage, and so on). It is always worth spending some time having a look at your hardware components and exploring the online catalogue.</p>
<blockquote>
<p><a href="https://twitter.com/_kylma" target="_blank" rel="noopener">Kylma</a> added a link to some <a href="https://www.eevblog.com/forum/beginners/datasheet-database/" target="_blank" rel="noopener">datasheets</a></p>
</blockquote>
<p>Let’s start the hands-on now in the budget form:</p>
<h3 id="Accessing-the-code"><a href="#Accessing-the-code" class="headerlink" title="Accessing the code"></a>Accessing the code</h3><p>Dumping the code from the <a href="https://en.wikipedia.org/wiki/Integrated_circuit" target="_blank" rel="noopener">Integrated Circuit</a> - short <strong>IC</strong> - and unpacking it are the steps described here. This can be the easiest and the most complex part of the process. You don’t need any expensive device and there are plenty of freeware tools available (many also open source!).</p>
<p>As I stated before, most of the devices have datasheets available online. Find a datasheet for your IC enables you to skip the process of identifying the pinouts \m/ Now, we need to identify how the communication works on the board. Here we are actively looking for signals which could interfere in the data dumping / reading. How to avoid the data interference during the dumping depends highly on the device you have in your hands.</p>
<h4 id="Do-you-mean-I-need-to-desolder"><a href="#Do-you-mean-I-need-to-desolder" class="headerlink" title="Do you mean I need to desolder?"></a>Do you mean I need to desolder?</h4><p>This would be the obvious way to go, right? If you don’t want other components of the board interfering the signal received from the IC you are analyzing, disconnect it from the board and go go go! This method gives you total control of the IC and it is lots of fun! But… this process requires some experience and TIME. The idea here is to keep it as simple as it gets and as cheap as it gets, so try to avoid this situation and use your “creativity”. It is possible to create something to monitor the other devices on the board and supply power just to your IC? This is just one side idea :)</p>
<p>As soon as your IC is isolated, connect it to a power supply and a computer, so that you can start reading the memory, block per block. This part can take some time, so don’t think much and go grab a coffee :)</p>
<h3 id="Dumping-the-code"><a href="#Dumping-the-code" class="headerlink" title="Dumping the code"></a>Dumping the code</h3><p>To create your own tools can be really fun, but it costs time and it is way easier when you actually know what you are doing ;) So if it is your first hardware, I would recommend you to use some nice open source projects available out there.</p>
<p>To dump the flash, I really like <a href="https://www.flashrom.org/Flashrom" target="_blank" rel="noopener">flashrom</a> which is indeed one of the most popular tools for it. It is easy to use, a bit buggy but it works in my Rasperry Pi :) <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/file.html" target="_blank" rel="noopener">file</a> is always useful and I start nothing before at least having an idea about the fie format I am dealing with. So if file doesn’t work, you can always go back to the unfamous <a href="https://github.com/ReFirmLabs/binwalk" target="_blank" rel="noopener">binwalk</a>.</p>
<p>From the binwalk logs, it is possible to recover important addresses. With them you can use <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/dd.html" target="_blank" rel="noopener">dd</a> to split the binaries into specific segments. The dd command needs some arguments like <em>bs</em> (block size), <em>skip</em> (offset) and <em>size</em>. You are probably going to have at least three segments:</p>
<ul>
<li>bootloader.bin: often not encrypted, used directly by the microcontroller so yeah…</li>
<li>kernel.bin: if you are lucky, it will be some kind of Linux Kernel. This is the code which controls the bare metal :) Often the most fun one to reverse and often compressed. Again, use file to find out the best way to decompress it.</li>
<li>rootfs.bin: this is the file system containing all the system files, configuration files and also system binaries. Again, use file to find out the best way to decompress it.</li>
</ul>
<p>If the image is encrypted, decrypt it using <a href="https://github.com/hyc/fcrackzip" target="_blank" rel="noopener">fcrackzip</a>.</p>
<h5 id="Cheatsheet"><a href="#Cheatsheet" class="headerlink" title="Cheatsheet"></a>Cheatsheet</h5><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">dd</span> if<span class="token operator">=</span>image.zip of<span class="token operator">=</span>firmware.zip bs<span class="token operator">=</span>64 skip<span class="token operator">=</span>1 <span class="token comment" spellcheck="true"># extract firmware images</span>
$ fcrackzip <span class="token function">file</span> <span class="token comment" spellcheck="true"># cracks zip file</span>
$ binwalk -e file.bin <span class="token comment" spellcheck="true"># extract compress bin images</span>
$ unyaffs <span class="token function">file</span> <span class="token comment" spellcheck="true"># extract .unyaffs2 filesystem mount points</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>Post written originally in pt_br as a <a href="https://www.mentebinaria.com.br/artigos/revertendo-firmware-conversando-com-o-seu-device-r37/" target="_blank" rel="noopener">guest post to Mente Binaria</a> and it wouldn’t be here without the precious help of <a href="https://twitter.com/_kylma" target="_blank" rel="noopener">Kylma</a>.</p>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css"><p>this has been written by me for fun purposes, don't take it serious!</p></div><br><div class="tags"><a href="/tags/firmware/"><i class="fa fa-tag"></i>firmware</a><a href="/tags/reversing/"><i class="fa fa-tag"></i>reversing</a></div><div class="post-nav"><a class="pre" href="/2018-10-03-logicvsmalware/">Logic &amp; binaries</a><a class="next" href="/2018-07-23-hardware_101/">Hardware 101 - I have this $device... and now?</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/ctf/" style="font-size: 15px;">ctf</a> <a href="/tags/Challenge-Cyber-Sec/" style="font-size: 15px;">Challenge Cyber Sec</a> <a href="/tags/prolog/" style="font-size: 15px;">prolog</a> <a href="/tags/low-level/" style="font-size: 15px;">low level</a> <a href="/tags/platform/" style="font-size: 15px;">platform</a> <a href="/tags/system/" style="font-size: 15px;">system</a> <a href="/tags/SMM/" style="font-size: 15px;">SMM</a> <a href="/tags/God-mode/" style="font-size: 15px;">God mode</a> <a href="/tags/haskell/" style="font-size: 15px;">haskell</a> <a href="/tags/internals/" style="font-size: 15px;">internals</a> <a href="/tags/analysis/" style="font-size: 15px;">analysis</a> <a href="/tags/reverse-engineering/" style="font-size: 15px;">reverse engineering</a> <a href="/tags/firmware/" style="font-size: 15px;">firmware</a> <a href="/tags/binary-analysis/" style="font-size: 15px;">binary analysis</a> <a href="/tags/reversing/" style="font-size: 15px;">reversing</a> <a href="/tags/hardware/" style="font-size: 15px;">hardware</a> <a href="/tags/smt-solvers/" style="font-size: 15px;">smt solvers</a> <a href="/tags/malware/" style="font-size: 15px;">malware</a> <a href="/tags/talks/" style="font-size: 15px;">talks</a> <a href="/tags/research/" style="font-size: 15px;">research</a> <a href="/tags/science/" style="font-size: 15px;">science</a> <a href="/tags/misc/" style="font-size: 15px;">misc</a> <a href="/tags/bios/" style="font-size: 15px;">bios</a> <a href="/tags/interrupt/" style="font-size: 15px;">interrupt</a> <a href="/tags/exception/" style="font-size: 15px;">exception</a> <a href="/tags/handler/" style="font-size: 15px;">handler</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020-06-19-how-to-research/">How Do I Do Research?</a></li><li class="post-list-item"><a class="post-list-link" href="/2019-08-15-system-managing-god/">SMMMmmmm - when root is not enough</a></li><li class="post-list-item"><a class="post-list-link" href="/2019-04-28-first-steps-into-the-bios/">Learning about the BIOS</a></li><li class="post-list-item"><a class="post-list-link" href="/2018-10-03-logicvsmalware/">Logic & binaries</a></li><li class="post-list-item"><a class="post-list-link" href="/2018-08-03-firmware_101/">Firmware 101 - How to get the code</a></li><li class="post-list-item"><a class="post-list-link" href="/2018-07-23-hardware_101/">Hardware 101 - I have this $device... and now?</a></li><li class="post-list-item"><a class="post-list-link" href="/2018-07-20-genRE/">/me on reverse engineering</a></li><li class="post-list-item"><a class="post-list-link" href="/2018-07-06-memory_skrolli/">Tinkering the memory</a></li><li class="post-list-item"><a class="post-list-link" href="/2018-07-03-hsandprolog/">Prolog vs Haskell</a></li><li class="post-list-item"><a class="post-list-link" href="/2018-06-09-prolog08/">PROLOG - Part 8</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">barbie's notes.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.1" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/love.js"></script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.1"></script></div></body></html>